window.jQuery&&function(e){"use strict";function i(e){return e>1048576?(e/1048576).toFixed(1)+"Mb":1024==e?"1Mb":(e/1024).toFixed(1)+"Kb"}function t(e){return(e.files&&e.files.length?e.files:null)||[{name:e.value,size:0,type:((e.value||"").match(/[^\.]+$/i)||[""])[0]}]}e.fn.MultiFile=function(a){if(0==this.length)return this;if("string"==typeof arguments[0]){if(this.length>1){var l=arguments;return this.each((function(){e.fn.MultiFile.apply(e(this),l)}))}return e.fn.MultiFile[arguments[0]].apply(this,e.makeArray(arguments).slice(1)||[])}"number"==typeof a&&(a={max:a});a=e.extend({},e.fn.MultiFile.options,a||{});e("form").not("MultiFile-intercepted").addClass("MultiFile-intercepted").submit(e.fn.MultiFile.disableEmpty),e.fn.MultiFile.options.autoIntercept&&(e.fn.MultiFile.intercept(e.fn.MultiFile.options.autoIntercept),e.fn.MultiFile.options.autoIntercept=null),this.not(".MultiFile-applied").addClass("MultiFile-applied").each((function(){window.MultiFile=(window.MultiFile||0)+1;var l=window.MultiFile,n={e:this,E:e(this),clone:e(this).clone()},r=e.extend({},e.fn.MultiFile.options,a||{},(e.metadata?n.E.metadata():e.meta?n.E.data():null)||{},{});r.max>0||(r.max=n.E.attr("maxlength")),r.max>0||(r.max=(String(n.e.className.match(/\b(max|limit)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],r.max>0?r.max=String(r.max).match(/[0-9]+/gi)[0]:r.max=-1),r.max=new Number(r.max),r.accept=r.accept||n.E.attr("accept")||"",r.accept&&r.accept.match(/\//)&&(r.accept=""),r.accept||(r.accept=n.e.className.match(/\b(accept\-[\w\|]+)\b/gi)||"",r.accept=new String(r.accept).replace(/^(accept|ext)\-/i,"")),r.maxsize=r.maxsize>0?r.maxsize:n.E.data("maxsize")||0,r.maxsize>0||(r.maxsize=(String(n.e.className.match(/\b(maxsize|maxload|size)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],r.maxsize>0?r.maxsize=String(r.maxsize).match(/[0-9]+/gi)[0]:r.maxsize=-1),r.maxfile=r.maxfile>0?r.maxfile:n.E.data("maxfile")||0,r.maxfile>0||(r.maxfile=(String(n.e.className.match(/\b(maxfile|filemax)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],r.maxfile>0?r.maxfile=String(r.maxfile).match(/[0-9]+/gi)[0]:r.maxfile=-1),r.maxfile>1&&(r.maxfile=1024*r.maxfile),r.maxsize>1&&(r.maxsize=1024*r.maxsize),!1!==r.multiple&&r.max>1&&n.E.attr("multiple","multiple").prop("multiple",!0),e.extend(n,r||{}),n.STRING=e.extend({},e.fn.MultiFile.options.STRING,n.STRING),e.extend(n,{n:0,slaves:[],files:[],instanceKey:n.e.id||"MultiFile"+String(l),generateID:function(e){return n.instanceKey+(e>0?"_F"+String(e):"")},trigger:function(i,a,l,n){var r,s=l[i]||l["on"+i];if(s)return n=n||l.files||t(this),e.each(n,(function(e,i){r=s.apply(l.wrapper,[a,i.name,l,i])})),r}}),String(n.accept).length>1&&(n.accept=n.accept.replace(/\W+/g,"|").replace(/^\W|\W$/g,""),n.rxAccept=new RegExp("\\.("+(n.accept?n.accept:"")+")$","gi")),n.wrapID=n.instanceKey,n.E.wrap('<div class="MultiFile-wrap" id="'+n.wrapID+'"></div>'),n.wrapper=e("#"+n.wrapID),n.e.name=n.e.name||"file"+l+"[]",n.list||(n.wrapper.append('<div class="MultiFile-list" id="'+n.wrapID+'_list"></div>'),n.list=e("#"+n.wrapID+"_list")),n.list=e(n.list),n.addSlave=function(a,r){var s;n.n++,a.MultiFile=n,a.id=a.name="",a.id=n.generateID(r),a.name=String(n.namePattern.replace(/\$name/gi,e(n.clone).attr("name")).replace(/\$id/gi,e(n.clone).attr("id")).replace(/\$g/gi,l).replace(/\$i/gi,r)),n.max>0&&n.files.length>n.max&&(a.disabled=!0,s=!0),n.current=a,(a=e(a)).val("").attr("value","")[0].value="",a.attr("required",!1),a.addClass("MultiFile-applied"),a.change((function(l,s,c){e(this).blur();var o=this,p=n.files||[],u=this.files||[{name:this.value,size:0,type:((this.value||"").match(/[^\.]+$/i)||[""])[0]}],m=[],f=0,d=n.total_size||0,g=[];e.each(u,(function(e,i){m[m.length]=i})),n.trigger("FileSelect",this,n,m),e.each(u,(function(a,l){var r=l.name.replace(/^C:\\fakepath\\/gi,""),s=l.size,c=function(e){return e.replace("$ext",String(r.match(/[^\.]+$/i)||"")).replace("$file",r.match(/[^\/\\]+$/gi)).replace("$size",i(s)+" > "+i(n.maxfile))};n.accept&&r&&!r.match(n.rxAccept)&&(g[g.length]=c(n.STRING.denied),n.trigger("FileInvalid",this,n,[l])),e(n.wrapper).find("input[type=file]").not(o).each((function(){e.each(t(this),(function(e,i){if(i.name){var t=(i.name||"").replace(/^C:\\fakepath\\/gi,"");r!=t&&r!=t.substr(t.length-r.length)||(g[g.length]=c(n.STRING.duplicate),n.trigger("FileDuplicate",o,n,[i]))}}))})),n.maxfile>0&&s>0&&s>n.maxfile&&(g[g.length]=c(n.STRING.toobig),n.trigger("FileTooBig",this,n,[l]));var p=n.trigger("FileValidate",this,n,[l]);p&&""!=p&&(g[g.length]=c(p)),f+=l.size})),d+=f,m.size=f,m.total=d,m.total_length=m.length+p.length,n.max>0&&p.length+u.length>n.max&&(g[g.length]=n.STRING.toomany.replace("$max",n.max),n.trigger("FileTooMany",this,n,m)),n.maxsize>0&&d>n.maxsize&&(g[g.length]=n.STRING.toomuch.replace("$size",i(d)+" > "+i(n.maxsize)),n.trigger("FileTooMuch",this,n,m));var h=e(n.clone).clone();if(h.addClass("MultiFile"),g.length>0)return n.error(g.join("\n\n")),n.n--,n.addSlave(h[0],r),a.parent().prepend(h),a.remove(),!1;n.total_size=d,(u=p.concat(m)).size=d,u.size_label=i(d),n.files=u,e(this).css({position:"absolute",top:"-3000px"}),a.after(h),n.addSlave(h[0],r+1),n.addToList(this,r,m),n.trigger("afterFileSelect",this,n,m)})),e(a).data("MultiFile-wrap",n.wrapper),e(n.wrapper).data("MultiFile",n),s&&e(a).attr("disabled","disabled").prop("disabled",!0)},n.addToList=function(a,l,s){n.trigger("FileAppend",a,n,s);var c=e("<span/>");e.each(s,(function(t,l){var s=String(l.name||"").replace(/[&<>'"]/g,(function(e){return"&#"+e.charCodeAt()+";"})),o=n.STRING,p=o.label||o.file||o.name,u=o.title||o.tooltip||o.selected,m="image/"==l.type.substr(0,6)?'<img class="MultiFile-preview" style="'+n.previewCss+'"/>':"",f=e(('<span class="MultiFile-label" title="'+u+'"><span class="MultiFile-title">'+p+"</span>"+(n.preview||e(a).is(".with-preview")?m:"")+"</span>").replace(/\$(file|name)/gi,(s.match(/[^\/\\]+$/gi)||[s])[0]).replace(/\$(ext|extension|type)/gi,(s.match(/[^\.]+$/gi)||[""])[0]).replace(/\$(size)/gi,i(l.size||0)).replace(/\$(preview)/gi,m).replace(/\$(i)/gi,t));f.find("img.MultiFile-preview").each((function(){var e=this,i=new FileReader;i.readAsDataURL(l),i.onload=function(i){e.src=i.target.result}})),t>0&&r.separator&&c.append(r.separator),c.append(f);s=String(l.name||"");c[c.length]=('<span class="MultiFile-title" title="'+n.STRING.selected+'">'+n.STRING.file+"</span>").replace(/\$(file|name)/gi,(s.match(/[^\/\\]+$/gi)||[s])[0]).replace(/\$(ext|extension|type)/gi,(s.match(/[^\.]+$/gi)||[""])[0]).replace(/\$(size)/gi,i(l.size||0)).replace(/\$(i)/gi,t)}));var o=e('<div class="MultiFile-label"></div>'),p=e('<a class="MultiFile-remove" href="#'+n.wrapID+'">'+n.STRING.remove+"</a>").click((function(){var l=t(a);n.trigger("FileRemove",a,n,l),n.n--,n.current.disabled=!1,e(a).remove(),e(this).parent().remove(),e(n.current).css({position:"",top:""}),e(n.current).reset().val("").attr("value","")[0].value="";var r=[],s=0;return e(n.wrapper).find("input[type=file]").each((function(){e.each(t(this),(function(e,i){i.name&&(r[r.length]=i,s+=i.size)}))})),n.files=r,n.total_size=s,n.size_label=i(s),e(n.wrapper).data("MultiFile",n),n.trigger("afterFileRemove",a,n,l),n.trigger("FileChange",n.current,n,r),!1}));n.list.append(o.append(p," ",c)),n.trigger("afterFileAppend",a,n,s),n.trigger("FileChange",a,n,n.files)},n.MultiFile||n.addSlave(n.e,0),n.n++}))},e.extend(e.fn.MultiFile,{data:function(){var i=e(this),t=i.is(".MultiFile-wrap")?i:i.data("MultiFile-wrap");if(!t||!t.length)return!console.error("Could not find MultiFile control wrapper");var a=t.data("MultiFile");return a?a||{}:!console.error("Could not find MultiFile data in wrapper")},reset:function(){var i=this.MultiFile("data");return i&&e(i.list).find("a.MultiFile-remove").click(),e(this)},files:function(){var e=this.MultiFile("data");return e?e.files||[]:!console.log("MultiFile plugin not initialized")},size:function(){var e=this.MultiFile("data");return e?e.total_size||0:!console.log("MultiFile plugin not initialized")},count:function(){var e=this.MultiFile("data");return e?e.files&&e.files.length||0:!console.log("MultiFile plugin not initialized")},disableEmpty:function(i){i=("string"==typeof i?i:"")||"mfD";var t=[];return e("input:file.MultiFile").each((function(){""==e(this).val()&&(t[t.length]=this)})),window.clearTimeout(e.fn.MultiFile.reEnableTimeout),e.fn.MultiFile.reEnableTimeout=window.setTimeout(e.fn.MultiFile.reEnableEmpty,500),e(t).each((function(){this.disabled=!0})).addClass(i)},reEnableEmpty:function(i){return e("input:file."+(i=("string"==typeof i?i:"")||"mfD")).removeClass(i).each((function(){this.disabled=!1}))},intercepted:{},intercept:function(i,t,a){var l,n;if((a=a||[]).constructor.toString().indexOf("Array")<0&&(a=[a]),"function"==typeof i)return e.fn.MultiFile.disableEmpty(),n=i.apply(t||window,a),setTimeout((function(){e.fn.MultiFile.reEnableEmpty()}),1e3),n;i.constructor.toString().indexOf("Array")<0&&(i=[i]);for(var r=0;r<i.length;r++)(l=i[r]+"")&&function(i){e.fn.MultiFile.intercepted[i]=e.fn[i]||function(){},e.fn[i]=function(){return e.fn.MultiFile.disableEmpty(),n=e.fn.MultiFile.intercepted[i].apply(this,arguments),setTimeout((function(){e.fn.MultiFile.reEnableEmpty()}),1e3),n}}(l)}}),e.fn.MultiFile.options={accept:"",max:-1,maxfile:-1,maxsize:-1,namePattern:"$name",preview:!1,previewCss:"max-height:100px; max-width:100px;",separator:", ",STRING:{remove:"x",denied:"You cannot select a $ext file.\nTry again...",file:"$file",selected:"File selected: $file",duplicate:"This file has already been selected:\n$file",toomuch:"The files selected exceed the maximum size permited ($size)",toomany:"Too many files selected (max: $max)",toobig:"$file is too big (max $size)"},autoIntercept:["submit","ajaxSubmit","ajaxForm","validate","valid"],error:function(e){"undefined"!=typeof console&&console.log(e),alert(e)}},e.fn.reset=e.fn.reset||function(){return this.each((function(){try{this.reset()}catch(e){}}))},e((function(){e("input[type=file].multi").MultiFile()}))}(jQuery);
